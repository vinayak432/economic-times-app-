pipeline {
    agent { label 'java' }

    tools{
    jdk 'JDK17'
    maven 'maven'
    }

    stages {
      
        stage('checkout') {
            steps {
                sh "rm -rf economic-times-app-"
              sh  "git clone https://github.com/vinayak432/economic-times-app-.git"
            }
        }
   stage(' build') {
            steps {
                sh "mvn clean package"
                sh "sudo cp target/*.war /opt/tomcat10/webapps"
            }
        }

stage('Push the artifacts into JFrog Artifactory') {
            steps {
                script {
                    // Define WAR file path
                    //def WAR_FILE = "${env.WORKSPACE}/target/economic-times-app.war"
                        

                    def WAR_FILE = "/home/slave1/workspace/economic-times-app/target/economic-times-app.war"
                    
                    // Current timestamp
                    def currentDate = new java.text.SimpleDateFormat("yyyy-MM-dd_HH-mm").format(new Date())

                    // Path inside Artifactory
                    def targetPath = "feature_release1/${currentDate}/"

                    rtUpload(
                        serverId: "jfrog",
                        spec: """{
                            "files": [
                                {
                                    "pattern": "${WAR_FILE}",
                                    "target": "${targetPath}"
                                }
                            ]
                        }"""
                    )
                }
            }
        }
    
  }
}
